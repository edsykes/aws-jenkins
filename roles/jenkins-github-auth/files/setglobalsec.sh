currentuser=$(whoami)
echo "running script as $currentuser"

echo "github web url is $1"
echo "github api url is $2"
echo "github app client id $3"
echo "github app client secret is $4"
data='_.useSecurity=on&slaveAgentPort.type=random&stapler-class=hudson.security.LegacySecurityRealm&$class=hudson.security.LegacySecurityRealm&realm=1&stapler-class=org.jenkinsci.plugins.GithubSecurityRealm&$class=org.jenkinsci.plugins.GithubSecurityRealm&_.githubWebUri='
data=$data$1
data=$data'&_.githubApiUri='
data=$data$2
data=$data'&_.clientID='
data=$data$3
data=$data'&_.clientSecret='
data=$data$4
data=$data'&_.oauthScopes=read:org,user:email&stapler-class=hudson.security.HudsonPrivateSecurityRealm&$class=hudson.security.HudsonPrivateSecurityRealm&_.allowsSignup=on&stapler-class=hudson.security.LDAPSecurityRealm&$class=hudson.security.LDAPSecurityRealm&_.server=&_.rootDN=&_.userSearchBase=&_.userSearch=uid={0}&_.userIdStrategyClass=jenkins.model.IdStrategy$CaseInsensitive&_.groupIdStrategyClass=jenkins.model.IdStrategy$CaseInsensitive&_.groupSearchBase=&_.groupSearchFilter=&_.attribute=memberOf&stapler-class=jenkins.security.plugins.ldap.FromUserRecordLDAPGroupMembershipStrategy&$class=jenkins.security.plugins.ldap.FromUserRecordLDAPGroupMembershipStrategy&_.filter=&stapler-class=jenkins.security.plugins.ldap.FromGroupSearchLDAPGroupMembershipStrategy&$class=jenkins.security.plugins.ldap.FromGroupSearchLDAPGroupMembershipStrategy&_.managerDN=&_.managerPasswordSecret=&_.displayNameAttributeName=displayname&_.mailAddressAttributeName=mail&_.size=20&_.ttl=300&stapler-class=hudson.security.PAMSecurityRealm&$class=hudson.security.PAMSecurityRealm&_.serviceName=&authorization=0&stapler-class=hudson.security.AuthorizationStrategy$Unsecured&$class=hudson.security.AuthorizationStrategy$Unsecured&stapler-class=org.jenkinsci.plugins.GithubAuthorizationStrategy&$class=org.jenkinsci.plugins.GithubAuthorizationStrategy&_.adminUserNames=&_.organizationNames=&stapler-class=hudson.security.LegacyAuthorizationStrategy&$class=hudson.security.LegacyAuthorizationStrategy&stapler-class=hudson.security.FullControlOnceLoggedInAuthorizationStrategy&$class=hudson.security.FullControlOnceLoggedInAuthorizationStrategy&stapler-class=hudson.security.GlobalMatrixAuthorizationStrategy&$class=hudson.security.GlobalMatrixAuthorizationStrategy&stapler-class=hudson.security.ProjectMatrixAuthorizationStrategy&$class=hudson.security.ProjectMatrixAuthorizationStrategy&stapler-class=hudson.markup.EscapedMarkupFormatter&$class=hudson.markup.EscapedMarkupFormatter&stapler-class=hudson.markup.RawHtmlMarkupFormatter&$class=hudson.markup.RawHtmlMarkupFormatter&stapler-class=hudson.security.csrf.DefaultCrumbIssuer&$class=hudson.security.csrf.DefaultCrumbIssuer&core:apply=&json={"useSecurity":+{"slaveAgentPort":+{"value":+"",+"type":+"random"},+"disableRememberMe":+false,+"realm":+{"value":+"1",+"stapler-class":+"org.jenkinsci.plugins.GithubSecurityRealm",+"$class":+"org.jenkinsci.plugins.GithubSecurityRealm",+"githubWebUri":+"https://github.dev.global.tesco.org",+"githubApiUri":+"https://github.dev.global.tesco.org/api/v3",+"clientID":+"2fd2a687252557d131ac",+"clientSecret":+"b631ba0789077cdad921f6b335cfb2ba38fbcb48",+"oauthScopes":+"read:org,user:email"},+"authorization":+{"value":+"0",+"stapler-class":+"hudson.security.AuthorizationStrategy$Unsecured",+"$class":+"hudson.security.AuthorizationStrategy$Unsecured"}},+"":+"0",+"markupFormatter":+{"stapler-class":+"hudson.markup.EscapedMarkupFormatter",+"$class":+"hudson.markup.EscapedMarkupFormatter"},+"hudson-security-csrf-GlobalCrumbIssuerConfiguration":+{},+"jenkins-model-DownloadSettings":+{"useBrowser":+false},+"jenkins-security-s2m-MasterKillSwitchConfiguration":+{},+"core:apply":+""}&Submit=Save'

echo "curl data is $data"

curl -i 'http://localhost:8080/configureSecurity/configure' -H 'Origin: http://localhost:8080' -H 'Accept-Encoding: gzip, deflate' -H 'Accept-Language: en-US,en;q=0.8' -H 'Upgrade-Insecure-Requests: 1' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.109 Safari/537.36' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Cache-Control: max-age=0' -H 'Referer: http://localhost:8080/configureSecurity/' -H 'Connection: keep-alive' --data $data